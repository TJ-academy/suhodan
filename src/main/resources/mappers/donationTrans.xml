<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="donationTrans">

	<select id="list"
		resultType="com.example.suhodan.donation.DonationTransactionDTO">
		select * from donation_transaction order by donation_date
		desc
	</select>

	<select id="listPaging"
		resultType="com.example.suhodan.donation.DonationTransactionDTO">
		SELECT * FROM (
		SELECT ROWNUM AS rnum, a.*
		FROM (
		SELECT *
		FROM donation_transaction order by donation_date desc
		) a
		WHERE ROWNUM
		&lt;= #{end}
		)
		WHERE rnum &gt;= #{start}
	</select>

	<select id="listPagingSearch"
		resultType="com.example.suhodan.donation.DonationListDTO">
		SELECT *
		FROM (
		SELECT ROWNUM AS rnum, inner_query.*
		FROM (
		SELECT
		dt.transaction_id,
		dt.content_id,
		c.title AS content_title,
		dt.donor_id,
		dt.amount,
		dt.donation_date,
		dt.payment_method,
		dt.status,
		dt.merchant_uid,
		dt.refund_amount,
		dt.refund_date,
		dt.refund_reason,
		dt.reward_id,
		r.name AS reward_name
		FROM donation_transaction dt
		JOIN suho_donation_content c ON dt.content_id = c.content_id
		LEFT JOIN suho_reward r ON dt.reward_id = r.reward_id
		<where>
			<choose>
				<when test="searchType == 'donor_id' and searchKeyword != ''">
					dt.donor_id = #{searchKeyword}
				</when>
				<when test="searchType == 'content_title' and searchKeyword != ''">
					c.title LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
				</when>
			</choose>
		</where>
		ORDER BY dt.donation_date DESC
		) inner_query
		)
		WHERE rnum BETWEEN #{start} AND #{end}
	</select>

	<select id="getTotalCount" resultType="int">
		SELECT COUNT(*)
		FROM donation_transaction dt
		JOIN suho_donation_content
		c ON dt.content_id = c.content_id
		LEFT JOIN suho_reward r ON
		dt.reward_id = r.reward_id
		<where>
			<choose>
				<when test="searchType == 'donor_id' and searchKeyword != ''">
					dt.donor_id = #{searchKeyword, jdbcType=VARCHAR}
				</when>
				<when test="searchType == 'content_title' and searchKeyword != ''">
					c.title LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
				</when>
			</choose>
		</where>
	</select>

</mapper>