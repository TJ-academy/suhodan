<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="donationTrans">

	<select id="list"
		resultType="com.example.suhodan.donation.DonationTransactionDTO">
		select * from donation_transaction order by donation_date
		desc
	</select>

	<select id="listPaging"
		resultType="com.example.suhodan.donation.DonationTransactionDTO">
		SELECT * FROM (
		SELECT ROWNUM AS rnum, a.*
		FROM (
		SELECT *
		FROM donation_transaction order by donation_date desc
		) a
		WHERE ROWNUM
		&lt;= #{end}
		)
		WHERE rnum &gt;= #{start}
	</select>

	<select id="listPagingSearch"
		resultType="com.example.suhodan.donation.DonationListDTO">
		SELECT *
		FROM (
		SELECT ROWNUM AS rnum, dt.transaction_id,
		dt.content_id, c.title AS content_title,
		dt.donor_id, dt.amount, dt.donation_date,
		dt.payment_method, dt.status,
		dt.merchant_uid, dt.refund_amount,
		dt.refund_date, dt.refund_reason,
		dt.reward_id, r.name AS reward_name
		FROM (
		SELECT *
		FROM donation_transaction
		<choose>
			<when test="search_option == 'donor_id'">
				WHERE dt.donor_id = #{keyword}  <!-- donor_id 조건 -->
			</when>
			<when test="search_option == 'content_title'">
				WHERE c.title LIKE CONCAT('%', #{keyword}, '%')  <!-- content_title 조건 -->
			</when>
			<otherwise>
				<!-- 기본적으로 전체 조회 -->
			</otherwise>
		</choose>
		ORDER BY donation_date DESC
		) dt
		JOIN suho_donation_content c ON dt.content_id = c.content_id
		LEFT JOIN suho_reward r ON dt.reward_id = r.reward_id
		WHERE ROWNUM &lt;= #{end}
		)
		WHERE rnum &gt;= #{start};
	</select>

	<select id="getTotalCount" resultType="int">
		SELECT COUNT(*)
		FROM donation_transaction dt
		JOIN suho_donation_content
		c ON dt.content_id = c.content_id
		LEFT JOIN suho_reward r ON
		dt.reward_id = r.reward_id
		<where>
			<choose>
				<when test="search_option == 'donor_id'">
					AND dt.donor_id = #{keyword}
				</when>
				<when test="search_option == 'content_title'">
					AND c.title LIKE CONCAT('%', #{keyword}, '%')
				</when>
				<otherwise>
					<!-- 검색 옵션이 없으면 전체 조회 -->
				</otherwise>
			</choose>
		</where>
	</select>



</mapper>