<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypage">
	<select id="getUserBadge" resultType="com.example.suhodan.member.mypage.MypageDTO">
        SELECT id userbadge_id, user_id, b.badge_id badge_id, name badge_name, description badge_desc, img badge_img, get_date
        FROM suho_userbadge ub, suho_badge b
        WHERE ub.user_id = #{user_id} and ub.badge_id = b.badge_id
        ORDER BY ub.get_date
    </select>
    
    <select id="getUserBadgesPaged" resultType="com.example.suhodan.member.mypage.MypageDTO">
        select * from (
        	select inner_query.*, rownum as rn
        	from (
        		SELECT id userbadge_id, user_id, b.badge_id badge_id, name badge_name, description badge_desc, img badge_img, get_date
		        FROM suho_userbadge ub, suho_badge b
		        WHERE ub.user_id = #{user_id} and 
		        	ub.badge_id = b.badge_id
		        ORDER BY ub.get_date
        	) inner_query
        	where rownum &lt;= #{endRow}
        )
        where rn &gt;= #{startRow}
    </select>
    
    <select id="getUserBadgeCount" resultType="int">
	    SELECT COUNT(*)
	    FROM suho_userbadge
	    WHERE user_id = #{user_id}
	</select>
    
    <select id="badgeDetail" resultType="com.example.suhodan.member.mypage.MypageDTO">
    	SELECT id userbadge_id, user_id, b.badge_id badge_id, name badge_name, description badge_desc, img badge_img, get_date
        FROM suho_userbadge ub, suho_badge b
        WHERE ub.id = #{userbadge_id} and ub.badge_id = b.badge_id
    </select>
    
    <select id="myDonationHistory" parameterType="string" resultType="com.example.suhodan.donation.DonationHistoryDTO">
	     SELECT
	     	c.content_id	   AS content_id,
	     	c.location		   AS location,
	        c.title            AS title,
	        c.content          AS content,
	        c.filename		   AS filename,
	        t.amount           AS amount,
	        t.donation_date    AS donationDate
	    FROM donation_transaction       t
	         JOIN suho_donation_content c
	           ON c.content_id = t.content_id
	    WHERE t.donor_id = #{donorId}
	    ORDER BY t.donation_date DESC
    </select>
    
    <select id="selectDonationDetail" resultType="com.example.suhodan.donation.DonationDetailDTO">
	     SELECT 
		    c.title               AS title,
   	     	c.filename		   	  AS filename,
		    c.start_date          AS startDate,
		    c.end_date            AS endDate,
		    c.location            AS location,
		    t.payment_method      AS paymentMethod,
		    t.amount              AS amount,
		    t.donation_date       AS donationDate
	    FROM donation_transaction t
	    JOIN suho_donation_content c
	      ON t.content_id = c.content_id
	    WHERE t.content_id = #{contentId}
	      AND t.donor_id = #{donorId}
    </select>
</mapper>