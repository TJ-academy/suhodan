<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="orders">
	<insert id="order" parameterType="com.example.suhodan.orders.OrderDTO" useGeneratedKeys="true" keyProperty="order_id" keyColumn="order_id">
	    insert into suho_orders (
	        user_id, 
	        order_date, 
	        order_amount, 
	        pay_method, 
	        refund_bank, 
	        refund_account, 
	        order_address1, 
	        order_address2, 
	        phone
	    ) values (
	        #{user_id},
	        sysdate,
	        #{order_amount},
	        #{pay_method},
	        #{refund_bank},
	        #{refund_account},
	        #{order_address1},
	        #{order_address2},
	        #{phone}
	    )
	</insert>
	<!--  
	<select id="getUserOrders" resultType="map">
	    SELECT o.order_id, o.order_status, o.pay_method, 
	           oi.item_id, oi.product_name, oi.quantity, oi.unit_price
	    FROM suho_orders o
	    INNER JOIN suho_order_items oi ON o.order_id = oi.order_id
	    WHERE o.user_id = #{userId}
	</select>
	-->
	<select id="getUserOrders" resultType="map">
	    SELECT o.order_id, o.order_status, o.pay_method, o.order_date,
	           oi.item_id, oi.product_name, oi.quantity, oi.unit_price,
	           g.img
	    FROM suho_orders o
	    INNER JOIN suho_order_items oi ON o.order_id = oi.order_id
	    INNER JOIN suho_goods g ON oi.product_name = g.name
	    WHERE o.user_id = #{userId}
	    ORDER BY o.order_id, oi.item_id
	</select>
</mapper>